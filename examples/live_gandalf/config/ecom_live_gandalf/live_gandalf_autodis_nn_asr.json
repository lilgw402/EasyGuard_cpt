{
	"workflow": {
		"trainers": [
			"trainer"
		],
		"testers": [
			"tester"
		],
		"tracers": [
			"tracer"
		],
		"train_folder": "2022121[5-9]|2022122[0-8]",
		"val_folder": "2022121[5-9]|2022122[0-8]",
		"test_folder": "2022123[0-1]",
		"input_dir": "hdfs:///user/sham_check/ecom_live_gandalf/augustus/NN/dataset/ecom_live_gandalf_parquet_f_3_1_d_0/train",
		"val_input_dir": "hdfs:///user/sham_check/ecom_live_gandalf/augustus/NN/dataset/ecom_live_gandalf_parquet_f_3_1_d_0/validation",
		"test_input_dir": "hdfs:///user/sham_check/ecom_live_gandalf/augustus/NN/dataset/ecom_live_gandalf_parquet_f_3_1_d_0/test",
		"local_output_dir": "../ecom_live_gandalf/tmp",
		"hdfs_output_dir": "hdfs:///user/sham_check/ecom_live_gandalf/augustus/NN/tmp",
		"is_download": false,
		"cuda_visible_devices": "0"
	},
	"data_factory": {
		"type": "ParquetDataFactory",
		"batch_size": 128,
		"num_workers": 10,
		"num_parallel_reads": 8,
		"phase": "ecom_live_gandalf_nn_parquet_data_train"
	},
	"test_data_factory": {
		"type": "ParquetDataFactory",
		"batch_size": 512,
		"num_workers": 10,
		"num_parallel_reads": 8,
		"phase": "ecom_live_gandalf_nn_parquet_data_test",
		"shuffle": false
	},
	"feature_provider": {
		"type": "EcomLiveGandalfParquetAutoDisFeatureProvider",
		"feature_num": 150,
		"use_high_precision": true,
		"filtered_tags": "材质|功效",
		"slot_mask": [140,141,142,143,144,145,146,147,148,149],
		"feature_norm_info": {"0": [0.0, 16.0], "1": [0.0, 5207.0], "2": [-550.0, 1200.0], "3": [0.0, 2.0], "6": [0.0, 10.0], "7": [0.0, 253.0], "8": [0.0, 100.0], "11": [0.0, 28971.0], "16": [0.0, 1000.0], "17": [0.0, 440.0], "18": [0.0, 2.0], "21": [0.0, 108.0], "22": [0.0, 1620.0], "23": [0.0, 7327.0], "93": [0.0, 4.0], "94": [0.0, 5.0], "96": [-1.0, 1.0], "109": [0.0, 5372.0], "114": [0.0, 2949.0], "127": [-6.0, 1.0], "128": [-6.0, 1.0], "130": [0.0, 32.0]},
		"embedding_conf": {
			"author_embedding": 128
		}
	},
	"model_instance": {
		"type": "EcomLiveGandalfAutoDisV3NNAsrModel",
		"feature_num": 150,
		"slot_mask": [140,141,142,143,144,145,146,147,148,149],
		"bucket_output_size": 1024,
		"bucket_dim": 128,
		"bucket_num": 8,
		"enable_asr_embedding": 1,
		"enable_author_embedding": 0,
		"asr_encoder": "./models/weights/fashion_deberta_asr/deberta",
		"asr_encoder_param":{
			"max_length": 337,
			"embedding_dim":768,
			"encoder_freeze_layer":null,
			"emb_mode":"pool",
			"emb_dropout_prob":0.3,
			"num_hidden_layers":3,
			"num_attention_heads":3
		},
		"author_embedding_dim":128,
		"dropout": 0.3
	},
	"trainer": {
		"type": "SingleTask",
		"find_unused_parameters": true,
		"auto_resume":true,
		"ema": false,
		"epochs": 50,
		"train_max_iteration":  -1,
		"test_max_iteration": -1,
		"output_iteration": 500,
		"enable_amp": true,
		"optimizer": {
			"optimizer_name": "AdamW",
			"learning_rate": 0.0001
		},
		"checkpoint_saver": {
			"metric_key": "loss",
			"metric_direction": "desc",
			"save_checkpoint_top_k": 20
		}
	},
	"tester": {
		"type": "Test",
		"scan_date": [],
		"max_iteration": -1,
		"output_iteration": 200,
		"resume_checkpoint": "checkpoint_loss=0.39088.pth",
		"metrics": [
			{
				"type": "AUC",
				"score_key": "online_score",
				"label_key": "label",
				"fix_recall": 0.30,
				"dump_table_name": "../ecom_live_gandalf/ecom_live_gandalf_autodis_nn_v3_output/test_detail_metric.csv"
			},
			{
                "type": "GandalfDumper",
                "save_path": "deberta_3l_dropout_score.csv",
				"label_filed": "label",
				"tag_field": "verify_reason",
				"old_score_filed":"online_score",
				"old_high_threshold":0.164,
				"old_low_threshold":0.499,
                "collect_fields": [
                    "object_id",
					"verify_reason",
					"uv",
					"online_score",
                    "output",
                    "label"
                ]
            }
		]
	},
	"tracer": {
		"type": "FCNNTracer",
		"trace_format": "ts",
		"resume_checkpoint": "checkpoint_loss=0.39909.pth",
		"input_keys": [
			"auto_dis_input",
			"feature_dense",
			"input_ids",
			"attention_mask",
			"token_type_ids"
		],
		"output_keys": [
			"prob"
		],
		"verify": false
	}
}
